<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="../../public/stylesheets/navigation.css">
    <link rel="stylesheet" href="../../public/stylesheets/chat.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <link rel="shortcut icon" href="../images/i learn.png"  type="image/png" />
<title>I-Learn</title>
    <style>

    </style>
</head>
<body style="background-color: #333;">
    <input type="hidden" id="chatid" value="<%= chat %>" >
    <input type="hidden" id="sender" value="<%= sender %>" >
    <input type="hidden" id="receiver" value="<%= receiver %>" >

	<div class="container main-section" style="width: 100%;">
		<div class="row">
			<div class="col-md-3 col-sm-3 col-xs-12 left-sidebar">
				<div class="input-group searchbox">
                    <img src="/public/images/i learn.png" width="40%" style="margin-left: 25%;">
                    <h1 style="color: white;margin-left: 30%;"><b>I-Learn</b></h1>
                    <p style="margin-left: 20%;color: white;">Where You Discover Your Best.</p>
				</div>
				<div>
                    <div class="col-auto my-1" style="margin-left: 20%;width: 100%;margin-top: 80%;">
                        <% if(user.userRole == 'instructor') { %>
                        <a href="../../gp/myTeams"><button type="submit" class="btn btn-info" style="padding: 5%; width: 50%;">Back</button></a>
                        <% } %>
                        <% if(user.userRole == 'student') { %>
                            <a href="../../gp/list"><button type="submit" class="btn btn-info" style="padding: 5%;width: 50%;">Back</button></a>
                        <% } %>
                      </div>
				</div>
			</div>
			<div class="col-md-9 col-sm-9 col-xs-12 right-sidebar">
				<div class="row" style="display:flex;">
					<div class="col-md-12 right-header">
						<div class="right-header-img">
                            <% if(user.userRole == 'instructor') { %>
                                <img src="/public/images/chats.png">
                                <% } %>
                                <% if(user.userRole == 'student') { %>
                                    <img src="/public/images/chati.png">
                                <% } %>
						</div>
						<div class="right-header-detail">
							<p><%= receiver %></p>
							<span>you can send messages to that user.</span>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-md-12 right-header-contentChat">
                       
						<ul id="messagecontainer">
                        <% for(let msg of Message) { %>
                            <% if(msg.sender == user.userName){ %>
							<li>
                                <div class="containerr">
									<!-- <span> You <i class="fa fa-circle" aria-hidden="true"></i></span><br><br> -->
									<p><%= msg.content %>.</p>
								</div>
                            </li>
                            <% }else{ %>
							<li >
                                <div class="containerr darker">
									<!-- <span><i class="fa fa-circle" aria-hidden="true"></i> <%= receiver %> </span><br><br> -->
									<p><%= msg.content %>.</p>
								</div>
                            </li>
                            <% } %>

                            <% } %>
					</div>
				</div>
				<div class="row">
					<div class="col-md-12 right-chat-textbox">
                        <input type="text" id="message" name="message">
                                <button type="submit" class="btn btn-info" id="sendbtn"style="margin-left: 30px;"><i class="material-icons">
                            near_me
                            </i></button>
					</div>
				</div>
			</div>
		</div>
	</div>
    <script src = "/socket.io/socket.io.js"></script>


    <script>
        
       var socket = io();
       socket.on('connect',()=>{
        console.log('user connected')
    });
    
    
    const chatid=document.getElementById('chatid').value
        const msg = document.getElementById('message')
        const sendbtn =document.getElementById('sendbtn')
        const sender=document.getElementById('sender').value
        const receiver=document.getElementById('receiver').value
        const msgcont = document.getElementById('messagecontainer')
    
        socket.emit('joinchat',chatid)
    
        sendbtn.onclick = ()=>{
            let content = msg.value
            socket.emit('sendmessage',{
                chat:chatid,
                content:content,
                sender:sender,
                receiver:receiver
                
            },()=>{
                msg.value='';
            }
    )
    
                msg.value='';
        }
        
        socket.on('newmessage',msg=>{
            console.log(msg)
            if(msg.sender==sender) {
            let livemsg=document.createElement('div')
            livemsg.setAttribute('class','containerr')
            livemsg.textContent= msg.content;
            msgcont.appendChild(livemsg)
            msgcont.value=''
           // msgcont.innerHTML +=msg.sender+": "+msg.content
          } else {
            let livemsg=document.createElement('div')
            livemsg.setAttribute('class','containerr darker')
            livemsg.innerHTML=''
            livemsg.textContent= msg.content;
            msgcont.appendChild(livemsg)
            msgcont.value=''

          } }) 
    
    </script>
    
    <script>
        $(document).ready(function(){
            var height = $(window).height();
            $('.left-chat').css('height', (height - 92) + 'px');
            $('.right-header-contentChat').css('height', (height - 163) + 'px');
        });
    </script>
</body>
</html>

